<div class="data-picker-modal" *ngIf="show && !selectedWidgetType">
  <div class="data-picker-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3 style="margin: 0;">Select Widget Type:</h3>
      <button style="border: none; background: transparent; font-size: 1.2rem; cursor: pointer;" title="Close"
              (click)="closeModal()">
        âœ–
      </button>
    </div>

    <div class="widget-grid">
      <div *ngFor="let widget of widgetTypes" class="widget-option" (click)="selectWidgetType(widget.type)">
        {{ widget.label }}
      </div>
    </div>
  </div>
</div>

<div class="data-picker-modal" *ngIf="show && (selectedWidgetType==='single-stat' || selectedWidgetType==='multi-stat' || selectedWidgetType==='chart' || selectedWidgetType==='table')">
  <div class="data-picker-content">
    <!-- Tab Header -->
    <div class="tab-header">
      <button class="tab" [class.active]="activeTab === 'data'" (click)="activeTab = 'data'">ðŸ“Š Select Data</button>
      <button class="tab" [class.active]="activeTab === 'design'" (click)="activeTab = 'design'">ðŸŽ¨ Custom Design</button>
      <button style="margin-left:auto;border:none;background:transparent;font-size:1.1rem;cursor:pointer" (click)="closeModal()">âœ–</button>
    </div>

    <div *ngIf="activeTab === 'data'" class="design-body">
      <h3>Chart Stats:</h3>
      <ul>
        <li *ngFor="let chart of chartTypes" (click)="design.chartType = chart.value; applyChartSelection()">
          {{ chart.label }}
        </li>
      </ul>

      <h3>Box Stats:</h3>
      <ul>
        <li *ngFor="let stat of templateInput?.Stats" (click)="toggleStatSelection(stat)"
            [class.selected]="isStatSelected(stat)">
          {{ stat[0] }} â€” {{ stat[1] }}
        </li>
      </ul>

      <div class="form-group">
        <label for="layout">Layout:</label>
        <select [(ngModel)]="design.layoutDirection" id="layout">
          <option value="row">Vertical</option>
          <option value="horizontal">Horizontal</option>
        </select>
      </div>

      <div class="form-group">
        <input type="checkbox" id="applyCheckbox" checked />
        <label for="applyCheckbox">Apply Selected</label>
        <button class="apply-btn" (click)="applySelectedStats()">Apply</button>
      </div>

      <h3>Tables:</h3>
      <ul>
        <li *ngFor="let key of tableKeys()" (click)="selectTable(key)">
          {{ key }}
        </li>
      </ul>
    </div>

    <!-- Custom Design Tab -->
    <div *ngIf="activeTab === 'design'" class="design-body">
      <h3>Customize Style</h3>

      <div class="form-group">
        <label>Background:</label>
        <input type="color" [(ngModel)]="design.bgColor" />
        <label>Text:</label>
        <input type="color" [(ngModel)]="design.textColor" />
      </div>

      <div class="form-group">
        <label>Align:</label>
        <select [(ngModel)]="design.textAlign">
          <option value="left">Left</option>
          <option value="center">Center</option>
          <option value="right">Right</option>
        </select>
      </div>

      <div class="form-group">
        <label>Font:</label>
        <select [(ngModel)]="design.fontFamily">
          <option value="Arial">Arial</option>
          <option value="Verdana">Verdana</option>
          <option value="Tahoma">Tahoma</option>
          <option value="Georgia">Georgia</option>
        </select>
        <label>Size:</label>
        <input type="number" [(ngModel)]="design.fontSize" style="width: 60px;" /> px
      </div>

      <div class="preview-box" [ngStyle]="{
        'background-color': design.bgColor,
        'color': design.textColor,
        'text-align': design.textAlign,
        'font-family': design.fontFamily,
        'font-size.px': design.fontSize
      }">
        This is a preview
      </div>

      <div class="button-group">
        <button class="apply-btn" (click)="applyCustomDesign()">Apply</button>
        <button class="cancel-btn" (click)="closeDataPicker()">Cancel</button>
      </div>
    </div>
  </div>
</div>