<div class="control-center" *ngIf="drawModeONN">
  <button (click)="addWidget()" style="margin: 10px;">Add Widget</button>
  <button (click)="saveLayout()" style="margin: 10px;">ðŸ’¾ Save Layout</button>
  <button (click)="showLayout()" style="margin: 10px;">Preview</button>
  <button (click)="predefLayouts()" style="margin: 10px;">Predefined Layouts</button>
</div>

<div *ngIf="!drawModeONN">
  <button (click)="saveLayout()">ðŸ’¾ Save Layout</button>
</div>

<div #gridContainer class="grid-stack"></div>

<!-- Data Picker Modal -->
<div class="data-picker-modal" *ngIf="showDataPicker">
  <div class="data-picker-content">
    <div class="tabs">
      <button [class.active]="activeTab === 'data'" (click)="activeTab = 'data'">Select Data</button>
      <button [class.active]="activeTab === 'design'" (click)="activeTab = 'design'">Custom Design</button>
    </div>

    <!-- Select Data Tab -->
    <div *ngIf="activeTab === 'data'" class="tab-content">
      <h3>Select Data</h3>

      <label>Chart Stats:</label>
      <ul>
        <li *ngFor="let chart of chartTypes" (click)="design.chartType = chart.value; applyChartSelection()">
          {{ chart.label }}
        </li>
      </ul>
      <label>Boxes Stats:</label>
      <ul>
        <li *ngFor="let stat of templateInput.Stats" (click)="toggleStatSelection(stat)"
          [class.selected]="isStatSelected(stat)">
          {{ stat[0] }} â€” {{ stat[1] }}
        </li>
      </ul>
      <label>
        Layout:
        <select [(ngModel)]="design.layoutDirection" id="layout">
          <option value='column'>Vertical</option>
          <option value='row'>Horizontal</option>
        </select>
      </label>

      <button (click)="applySelectedStats()">âœ… Apply Selected</button>

      <label>Tables:</label>
      <ul>
        <li *ngFor="let key of tableKeys()" (click)="selectTable(key)">
          {{ key }}
        </li>
      </ul>
    </div>

    <!-- Custom Design Tab -->
    <div class="data-picker-modal" *ngIf="showDataPicker">
      <div class="data-picker-content">
        <div class="tab-header">
          <button class="tab" [class.active]="activeTab === 'data'" (click)="activeTab = 'data'">ðŸ“Š Select Data</button>
          <button class="tab" [class.active]="activeTab === 'design'" (click)="activeTab = 'design'">ðŸŽ¨ Custom
            Design</button>
        </div>

        <div *ngIf="activeTab === 'data'" class="design-body">
          <h3>Chart Stats:</h3>
          <ul>
            <li *ngFor="let chart of chartTypes" (click)="design.chartType = chart.value; applyChartSelection()">
              {{ chart.label }}
            </li>
          </ul>

          <h3>Box Stats:</h3>
          <ul>
            <li *ngFor="let stat of templateInput.Stats" (click)="toggleStatSelection(stat)"
              [class.selected]="isStatSelected(stat)">
              {{ stat[0] }} â€” {{ stat[1] }}
            </li>
          </ul>

          <div class="form-group">
            <label for="layout">Layout:</label>
            <select [(ngModel)]="design.layoutDirection" id="layout">
              <option value="row">Vertical</option>
              <option value="horizontal">Horizontal</option>
            </select>
          </div>

          <div class="form-group">
            <input type="checkbox" id="applyCheckbox" checked />
            <label for="applyCheckbox">Apply Selected</label>
            <button class="apply-btn" (click)="applySelectedStats()">Apply</button>
          </div>

          <h3>Tables:</h3>
          <ul>
            <li *ngFor="let key of tableKeys()" (click)="selectTable(key)">
              {{ key }}
            </li>
          </ul>
        </div>

        <div *ngIf="activeTab === 'design'" class="design-body">
          <h3>Customize Style</h3>

          <div class="form-group">
            <label>Background:</label>
            <input type="color" [(ngModel)]="design.bgColor" />
            <label>Text:</label>
            <input type="color" [(ngModel)]="design.textColor" />
          </div>

          <div class="form-group">
            <label>Align:</label>
            <select [(ngModel)]="design.textAlign">
              <option value="left">Left</option>
              <option value="center">Center</option>
              <option value="right">Right</option>
            </select>
          </div>

          <div class="form-group">
            <label>Font:</label>
            <select [(ngModel)]="design.fontFamily">
              <option value="Arial">Arial</option>
              <option value="Verdana">Verdana</option>
              <option value="Tahoma">Tahoma</option>
              <option value="Georgia">Georgia</option>
            </select>
            <label>Size:</label>
            <input type="number" [(ngModel)]="design.fontSize" style="width: 60px;" /> px
          </div>

          <div class="preview-box" [ngStyle]="{
        'background-color': design.bgColor,
        'color': design.textColor,
        'text-align': design.textAlign,
        'font-family': design.fontFamily,
        'font-size.px': design.fontSize
      }">
            This is a preview
          </div>

          <div class="button-group">
            <button class="apply-btn" (click)="applyCustomDesign()">Apply</button>
            <button class="cancel-btn" (click)="closeDataPicker()">Cancel</button>
          </div>
        </div>
      </div>
    </div>